<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Pokémon Egg Hatcher</title>
    <link rel="stylesheet" href="style/style-egg.css">
    <script src="scripts/egg.js" defer></script>
      <link rel="apple-touch-icon" sizes="180x180" href="favicon_io/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon_io/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon_io/favicon-16x16.png">
  <link rel="manifest" href="favicon_io/site.webmanifest">
</head>

<body>
<img src="left-icon-background-one.svg" alt="pokeball" class="pokeball">

    <h1>Pokémon Egg Hatcher</h1>

    <div id="counter-container">
        <img id="pokemon-img" src="img/Gebarsten Ei met Groene Vlekken.png" alt="Egg">
        <div id="hatch-count">0</div>
        <audio id="audio-cry" preload="auto"></audio>
        <audio id="egg-cracking" src="audio/egg-cracking-6844-VEED.mp3" preload="auto"></audio>
    </div>
    <br>
    <button id="test" onclick="location.href='index.html';" class="btn">Go to Pokédex</button>
    <button id="hatch-btn" class="btn">Hatch Egg!</button>
    <div id="result"></div>
    <div id="history"></div>
    <img src="img/comic-boom-explosion-2-1-1024x754.png" id="reveal" alt="comic explosion" class="hidden egg">
    <img src="" id="reveal-pokemon" alt="pokemon" class="hidden reveal-pokemon">
    
    <audio id="bg-music" src="game-corner.mp3" loop style="display:none;"></audio>

<script>
(function(){
  const audio      = document.getElementById('bg-music');
  const STORAGE_KEY = 'bg-music-currentTime';
  let autoPlayBlocked = false;

  // 1) Restore position and try to start as soon as metadata is ready
  audio.addEventListener('loadedmetadata', () => {
    const saved = parseFloat(localStorage.getItem(STORAGE_KEY)) || 0;
    if (saved < audio.duration) {
      audio.currentTime = saved;
    }
    audio.play().catch(_ => {
      // Autoplay was blocked, we'll resume on user gesture
      autoPlayBlocked = true;
      console.log('Autoplay blocked; will resume when you interact.');
    });
  });

  // 2) Keep saving currentTime as it plays
  audio.addEventListener('timeupdate', () => {
    localStorage.setItem(STORAGE_KEY, audio.currentTime);
  });

  // 3) Save one more time if they close/refresh mid-audio
  window.addEventListener('beforeunload', () => {
    localStorage.setItem(STORAGE_KEY, audio.currentTime);
  });

  // 4) If autoplay was blocked, resume on any user interaction
  function resumeOnFirstInteraction() {
    if (autoPlayBlocked && audio.paused) {
      audio.play().catch(_=>{});  // silent fail if still blocked
      autoPlayBlocked = false;
      // clean up listeners
      document.removeEventListener('click',      resumeOnFirstInteraction);
      document.removeEventListener('keydown',    resumeOnFirstInteraction);
      document.removeEventListener('touchstart', resumeOnFirstInteraction);
    }
  }
  document.addEventListener('click',      resumeOnFirstInteraction);
  document.addEventListener('keydown',    resumeOnFirstInteraction);
  document.addEventListener('touchstart', resumeOnFirstInteraction);

})();
</Script>

</body>

</html>