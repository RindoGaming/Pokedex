<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pokédex Display</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f8f8f8 }
    h1 { text-align: center; color: #d32f2f }
    button, select { display: block; margin: 10px auto; padding: 10px 20px; font-size: 1em; border-radius: 5px; border: none }
    button { background: #d32f2f; color: #fff; cursor: pointer }
    select { background: #fff; border: 1px solid #ccc }
    #filter-container { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 20px }
    #pokedex { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px }
    .pokemon {
      background: #fff; border: 1px solid #ccc; border-radius:8px; padding:10px; width:200px;
      box-shadow:0 2px 5px rgba(0,0,0,0.1); text-align:center; cursor:pointer; transition:transform .2s
    }
    .pokemon:hover { transform:scale(1.05) }
    .pokemon img { width:96px; height:96px; object-fit:contain }
    .pokemon h3 { margin:10px 0 5px; font-size:1.2em }
    .pokemon p { margin:4px 0; font-size:.9em }
  </style>
</head>
<body>
  <h1>Pokédex</h1>
  <button onclick="location.href='egg.html'">Go to Egg Hatcher</button>

  <div id="filter-container">
    <select id="type1-filter"><option value="">-- Primary Type --</option></select>
    <select id="type2-filter"><option value="">-- Secondary Type --</option></select>
  </div>

  <div id="pokedex"></div>

  <script>
    const pokedex     = document.getElementById('pokedex');
    const type1Filter = document.getElementById('type1-filter');
    const type2Filter = document.getElementById('type2-filter');
    let allPokemon    = [];

    fetch('pokemon_cache.json')
      .then(r => r.json())
      .then(data => {
        allPokemon = Object.entries(data)
          .map(([key, poke]) => ({
            id: poke.id ?? parseInt(key, 10),
            info: poke
          }))
          .sort((a, b) => a.id - b.id);

        // Populate type filters
        const types = new Set();
        allPokemon.forEach(p => {
          if (p.info.types) Object.keys(p.info.types).forEach(t => types.add(t));
        });
        [...types].sort().forEach(t => {
          [type1Filter, type2Filter].forEach(sel => {
            const opt = document.createElement('option');
            opt.value = t;
            opt.textContent = t[0].toUpperCase() + t.slice(1);
            sel.appendChild(opt);
          });
        });

        render(allPokemon);
        type1Filter.onchange = type2Filter.onchange = filter;
      })
      .catch(_ => pokedex.innerHTML = '<p>Failed to load Pokédex.</p>');

    function filter() {
      const t1 = type1Filter.value, t2 = type2Filter.value;
      render(allPokemon.filter(p => {
        const ts = p.info.types ? Object.keys(p.info.types) : [];
        if (t1 && !ts.includes(t1)) return false;
        if (t2 && !ts.includes(t2)) return false;
        return true;
      }));
    }

    function render(list) {
      pokedex.innerHTML = '';
      list.forEach(p => {
        const padded = String(p.id).padStart(3,'0');
        pokedex.innerHTML += `
          <div class="pokemon" onclick="goToDetails(${p.id})">
            <img src="${p.info.image||''}" alt="${p.info.name||'Unknown'}">
            <h3>${p.info.name||'N/A'}</h3>
            <p><strong>ID:</strong> ${padded}</p>
            <p><strong>Types:</strong> ${p.info.types?Object.keys(p.info.types).join(', '):'N/A'}</p>
            <p><strong>Abilities:</strong> ${p.info.abilities?Object.keys(p.info.abilities).join(', '):'N/A'}</p>
            <p><strong>Height:</strong> ${p.info.height||'N/A'}</p>
            <p><strong>Weight:</strong> ${p.info.weight||'N/A'}</p>
          </div>
        `;
      });
    }

    function goToDetails(id) {
      window.location.href = `pokemon.html?id=${id}`;
    }
  </script>
</body>
</html>