<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Pokédex Display</title>
  <style>

  </style>
  <link rel="stylesheet" href="style/style.css">
  <link rel="stylesheet" href="style/type.css">
</head>

<body>
  <header class="header">
    <h1>Pokédex</h1>
    <button onclick="location.href='egg.html'">Go to Egg Hatcher</button>

    <div id="filter-container">
      <select id="type1-filter">
        <option value="">-- Primary Type --</option>
      </select>
      <select id="type2-filter">
        <option value="">-- Secondary Type --</option>
      </select>
    </div>
  </header>
  <div class="main-background-section">
    <div id="pokedex"></div>
  </div>
  <script>
    const pokedex = document.getElementById('pokedex');
    const type1Filter = document.getElementById('type1-filter');
    const type2Filter = document.getElementById('type2-filter');
    let allPokemon = [];

  let allPokemon = [];
  let filteredPokemon = [];
  let currentPage = 1;
  const pageSize = 24;

  const paginationControls = document.createElement('div');
  paginationControls.style.textAlign = 'center';
  paginationControls.style.marginTop = '20px';
  paginationControls.innerHTML = `
    <button id="prev-btn">⬅ Previous</button>
    <span id="page-info" style="margin: 0 15px;"></span>
    <button id="next-btn">Next ➡</button>
  `;
  document.body.appendChild(paginationControls);

 
  const nextBtn = document.getElementById('next-btn');
  const pageInfo = document.getElementById('page-info');
  const prevBtn = document.getElementById('prev-btn');

  fetch('pokemon_cache.json')
    .then(r => r.json())
    .then(data => {
      allPokemon = Object.entries(data)
        .map(([key, poke]) => ({
          id: poke.id ?? parseInt(key, 10),
          info: poke
        }))
        .sort((a, b) => a.id - b.id);

    function render(list) {
      pokedex.innerHTML = '';
      list.forEach(p => {
        const padded = String(p.id).padStart(3, '0');
        pokedex.innerHTML += `
          <div class="pokemon" onclick="goToDetails(${p.id})">
            <img src="${p.info.image || ''}" alt="${p.info.name || 'Unknown'}">
            <p><strong>ID:</strong> ${padded}</p>
            <h3>${p.info.name || 'N/A'}</h3>
            <div><span class="type ${Object.keys(p.info.types)[0]}">${p.info.types ? Object.keys(p.info.types)[0] : 'N/A'}</span> ${p.info.types && Object.keys(p.info.types)[1]
            ? `<span class="type ${Object.keys(p.info.types)[1]}">${Object.keys(p.info.types)[1]}</span>`
            : ''}<div> 

          </div>
        `;
      });

      filteredPokemon = [...allPokemon];
      renderPage();
      type1Filter.onchange = type2Filter.onchange = () => {
        currentPage = 1;
        applyFilters();
      };
    })
    .catch(_ => pokedex.innerHTML = '<p>Failed to load Pokédex.</p>');

  function applyFilters() {
    const t1 = type1Filter.value, t2 = type2Filter.value;
    filteredPokemon = allPokemon.filter(p => {
      const ts = p.info.types ? Object.keys(p.info.types) : [];
      if (t1 && !ts.includes(t1)) return false;
      if (t2 && !ts.includes(t2)) return false;
      return true;
    });
    renderPage();
  }

  function renderPage() {
    pokedex.innerHTML = '';
    const start = (currentPage - 1) * pageSize;
    const end = start + pageSize;
    const pageItems = filteredPokemon.slice(start, end);

    pageItems.forEach(p => {
      const padded = String(p.id).padStart(3, '0');
      pokedex.innerHTML += `
        <div class="pokemon" onclick="goToDetails(${p.id})">
          <img src="${p.info.image || ''}" alt="${p.info.name || 'Unknown'}">
          <p><strong>ID:</strong> ${padded}</p>
          <h3>${p.info.name || 'N/A'}</h3>
          <div><span class="type ${Object.keys(p.info.types)[0]}">${p.info.types ? Object.keys(p.info.types)[0] : 'N/A'}</span> ${p.info.types && Object.keys(p.info.types)[1]
            ? `<span class="type ${Object.keys(p.info.types)[1]}">${Object.keys(p.info.types)[1]}</span>`
            : ''}<div>
        </div>
      `;
    });

    pageInfo.textContent = `Page ${currentPage} of ${Math.ceil(filteredPokemon.length / pageSize)}`;
    prevBtn.disabled = currentPage === 1;
    nextBtn.disabled = end >= filteredPokemon.length;
  }

  prevBtn.onclick = () => {
    if (currentPage > 1) {
      currentPage--;
      renderPage();
    }
  };

  nextBtn.onclick = () => {
    if ((currentPage * pageSize) < filteredPokemon.length) {
      currentPage++;
      renderPage();
    }
  };

  function goToDetails(id) {
    window.location.href = `pokemon.html?id=${id}`;
  }
</script>
</body>

</html>
<!-- <p><strong>Abilities:</strong> ${p.info.abilities?Object.keys(p.info.abilities).join(', '):'N/A'}</p>
            <p><strong>Height:</strong> ${p.info.height||'N/A'}</p>
            <p><strong>Weight:</strong> ${p.info.weight||'N/A'}</p> -->