<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pok√©dex Display</title>
  <link rel="stylesheet" href="style/style.css">
  <link rel="stylesheet" href="style/type.css">
</head>
<body>
  <header class="header">
    <h1>Pok√©dex</h1>
    <button onclick="location.href='egg.html'">Go to Egg Hatcher</button>

    <div id="filter-container">
      <select id="type1-filter">
        <option value="">-- Primary Type --</option>
      </select>
      <input type="text" id="searchbar" class="searchbar" placeholder="Search by name or ID...">
      <select id="type2-filter">
        <option value="">-- Secondary Type --</option>
      </select>
    </div>
  </header>

  <div class="main-background-section">
    <div id="pokedex"></div>
  </div>

  <div class="page-mover" style="text-align:center; margin-top:20px;">
    <button id="prev-btn">‚¨Ö Previous</button>
    <span id="page-info" style="margin: 0 15px; color: white"></span>
    <button id="next-btn">Next ‚û°</button>
  </div>

  <script>
    const pokedex = document.getElementById('pokedex');
    const type1Filter = document.getElementById('type1-filter');
    const type2Filter = document.getElementById('type2-filter');
    const searchbar = document.getElementById('searchbar');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const pageInfo = document.getElementById('page-info');

    let allPokemon = [];
    let filteredPokemon = [];
    let currentPage = 1;
    const pageSize = 24;

    fetch('pokemon_cache.json')
      .then(r => r.json())
      .then(data => {
        allPokemon = Object.entries(data)
          .map(([key, poke]) => ({
            id: poke.id ?? parseInt(key, 10),
            info: poke
          }))
          .sort((a, b) => a.id - b.id);

        const types = new Set();
        allPokemon.forEach(p => {
          if (p.info.types) Object.keys(p.info.types).forEach(t => types.add(t));
        });

        [...types].sort().forEach(t => {
          [type1Filter, type2Filter].forEach(sel => {
            const opt = document.createElement('option');
            opt.value = t;
            opt.textContent = t[0].toUpperCase() + t.slice(1);
            sel.appendChild(opt);
          });
        });

        filteredPokemon = [...allPokemon];
        renderPage();

        type1Filter.onchange = type2Filter.onchange = () => {
          currentPage = 1;
          applyFilters();
        };
        searchbar.oninput = () => {
          currentPage = 1;
          applyFilters();
        };
      })
      .catch(_ => pokedex.innerHTML = '<p>Failed to load Pok√©dex.</p>');

    function applyFilters() {
      const t1 = type1Filter.value;
      const t2 = type2Filter.value;
      const query = searchbar.value.trim().toLowerCase();

      filteredPokemon = allPokemon.filter(p => {
        const ts = p.info.types ? Object.keys(p.info.types) : [];
        const nameMatch = p.info.name?.toLowerCase().includes(query);
        const idMatch = String(p.id).padStart(3, '0').includes(query) || String(p.id).includes(query);

        if (query && !nameMatch && !idMatch) return false;
        if (t1 && !ts.includes(t1)) return false;
        if (t2 && !ts.includes(t2)) return false;
        return true;
      });

      renderPage();
    }

    function renderPage() {
      pokedex.innerHTML = '';
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageItems = filteredPokemon.slice(start, end);

      pageItems.forEach(p => {
        const padded = String(p.id).padStart(3, '0');
        const types = p.info.types ? Object.keys(p.info.types) : [];
        const typeHTML = types.map(t => `<span class="type ${t}">${t}</span>`).join(' ');

        pokedex.innerHTML += `
          <div class="pokemon" onclick="goToDetails(${p.id})">
            <img src="${p.info.image || ''}" alt="${p.info.name || 'Unknown'}">
            <p><strong>ID:</strong> ${padded}</p>
            <h3>${p.info.name || 'N/A'}</h3>
            <div>${typeHTML}</div>
          </div>
        `;
      });

      pageInfo.textContent = `Page ${currentPage} of ${Math.ceil(filteredPokemon.length / pageSize)}`;
      prevBtn.disabled = currentPage === 1;
      nextBtn.disabled = end >= filteredPokemon.length;
    }

    prevBtn.onclick = () => {
      if (currentPage > 1) {
        currentPage--;
        renderPage();
      }
    };

    nextBtn.onclick = () => {
      if ((currentPage * pageSize) < filteredPokemon.length) {
        currentPage++;
        renderPage();
      }
    };

    function goToDetails(id) {
      window.location.href = `pokemon.html?id=${id}`;
    }
  </script>

  <footer>
    <div class="team">
      <ul>
        <li>alex</li>
        <li>caspar</li>
        <li>jarno</li>
        <li>jay</li>
        <li>hendrik</li>
        <li>senn</li>
      </ul>
    </div>
    <div class="copyright">üç∑üóø lcc donotsu</div>
    <div class="note">
      <a href="https://www.pokemon.com/us/pokedex">inspiration</a>
    </div>
  </footer>
</body>
</html>