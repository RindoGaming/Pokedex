<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pok√©mon Details</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 20px; 
      background: #f0f0f0; 
      text-align: center; 
    }
    .pokemon-details {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 20px;
      max-width: 360px;
      margin: 0 auto;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .pokemon-details img {
      width: 120px;
      height: 120px;
      object-fit: contain;
    }
    .pokemon-details h2 {
      color: #d32f2f;
      margin: 10px 0;
    }
    .pokemon-details p {
      margin: 6px 0;
      font-size: .95em;
    }
    #cry-container {
      margin-top: 15px;
    }
    #play-cry {
      padding: 8px 16px;
      font-size: 1em;
      border: none;
      border-radius: 4px;
      background: #1976d2;
      color: #fff;
      cursor: pointer;
    }
    #play-cry:hover {
      background: #115293;
    }
    .back-button {
      display: inline-block;
      margin-top: 20px;
      padding: 10px 16px;
      background: #d32f2f;
      color: #fff;
      text-decoration: none;
      border-radius: 4px;
    }
    .back-button:hover {
      background: #b71c1c;
    }
    #variant-select {
      margin-top: 10px;
      padding: 5px;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h1>Pok√©mon Details</h1>
  <div id="details" class="pokemon-details"></div>
  <a href="index.html" class="back-button">‚Üê Back to Pok√©dex</a>

<script>
(function() {
  const params = new URLSearchParams(window.location.search);
  const rawId = params.get('id');
  const id = parseInt(rawId, 10);
  const detailsEl = document.getElementById('details');

  if (isNaN(id)) {
    detailsEl.innerHTML = '<p>Invalid Pok√©mon ID.</p>';
    return;
  }

  fetch('pokemon_cache.json')
    .then(res => res.json())
    .then(data => {
      let poke = data[rawId] || Object.values(data).find(p => p.id === id);
      let baseName = null;

      // If not found in base Pok√©mon, search in variants
      if (!poke) {
        for (const [bName, base] of Object.entries(data)) {
          if (base.variants) {
            for (const [vName, variant] of Object.entries(base.variants)) {
              if (variant.id === id || vName.toLowerCase() === rawId?.toLowerCase()) {
                poke = variant;
                baseName = bName;
                break;
              }
            }
          }
          if (poke) break;
        }
      } else {
        baseName = poke.name.toLowerCase();
      }

      if (!poke) {
        detailsEl.innerHTML = '<p>Pok√©mon not found.</p>';
        return;
      }

      function renderPokemon(p) {
        const types     = p.types     ? Object.keys(p.types).join(', ') : 'N/A';
        const abilities = p.abilities ? Object.keys(p.abilities).join(', ') : 'N/A';
        const height    = p.height    != null ? p.height : 'N/A';
        const weight    = p.weight    != null ? p.weight : 'N/A';

        // Variant dropdown if exists
        let variantOptions = '';
        const variants = baseName && data[baseName].variants ? data[baseName].variants : {};
        if (Object.keys(variants).length > 0) {
          variantOptions = `<select id="variant-select">
            <option value="">Base Form</option>
            ${Object.entries(variants).map(([vName, v]) => 
              `<option value="${vName}" ${vName === p.name ? 'selected' : ''}>${v.name}</option>`
            ).join('')}
          </select>`;
        }

        detailsEl.innerHTML = `
          <img src="${p.image || ''}" alt="${p.name || 'Unknown'}">
          <h2>${p.name || 'N/A'}</h2>
          <p><strong>ID:</strong> ${String(p.id).padStart(3, '0')}</p>
          <p><strong>Types:</strong> ${types}</p>
          <p><strong>Abilities:</strong> ${abilities}</p>
          <p><strong>Height:</strong> ${height}</p>
          <p><strong>Weight:</strong> ${weight}</p>
          ${variantOptions}
          <div id="cry-container">
            <button style="padding: 5px;" id="prev-pokemon">Previous Pok√©mon</button>
            <button id="play-cry">üîä Play Cry</button>
            <button style="padding: 5px;" id="next-pokemon">Next Pok√©mon</button>
            <audio id="audio-cry" preload="auto"></audio>
          </div>
        `;

        const audioEl = document.getElementById('audio-cry');
        const playBtn = document.getElementById('play-cry');
        audioEl.src = p.cry;
        playBtn.addEventListener('click', () => {
          audioEl.currentTime = 0;
          audioEl.play().catch(err => console.error('Cry failed to play', err));
        });

        // Variant selector
        const variantSelect = document.getElementById('variant-select');
        if (variantSelect) {
          variantSelect.addEventListener('change', (e) => {
            const vName = e.target.value;
            if (!vName) {
              renderPokemon(data[baseName]);
            } else {
              renderPokemon(data[baseName].variants[vName]);
            }
          });
        }

        // Navigation
        const prevBtn = document.getElementById('prev-pokemon');
        const nextBtn = document.getElementById('next-pokemon');
        prevBtn.addEventListener('click', () => {
          if (p.id > 1) window.location.href = `pokemon.html?id=${p.id - 1}`;
        });
        nextBtn.addEventListener('click', () => {
          if (p.id < 1164) window.location.href = `pokemon.html?id=${p.id + 1}`;
        });
      }

      renderPokemon(poke);
    })
    .catch(err => {
      console.error(err);
      detailsEl.innerHTML = '<p>Error loading Pok√©mon data.</p>';
    });
})();
</script>
</body>
</html>
